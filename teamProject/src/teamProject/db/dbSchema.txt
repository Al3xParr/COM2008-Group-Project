CREATE TABLE IF NOT EXISTS Accounts(
    username VARCHAR(50) NOT NULL,
    passwordHash CHAR(64) NOT NULL,
    salt CHAR(16) NOT NULL,
    accessLvl TINYINT NOT NULL,
    PRIMARY KEY (username)    
);

CREATE TABLE IF NOT EXISTS Students(
    regNum INT NOT NULL,
    title VARCHAR(3),
    surname VARCHAR(25),
    forenames VARCHAR(25),
    email VARCHAR(50),
    username VARCHAR(50) NOT NULL,
    tutor VARCHAR(50),
    courseCode CHAR(6),
    degreeLvl CHAR(1),
    PRIMARY KEY (regNum),
    FOREIGN KEY (username) REFERENCES Accounts(username) ON DELETE CASCADE,
    FOREIGN KEY (courseCode) REFERENCES Course(courseCode)
);

CREATE TABLE IF NOT EXISTS Course(
    courseCode CHAR(6) NOT NULL,
    fullName VARCHAR(50) NOT NULL,
    yearInIndustry BOOLEAN NOT NULL,
    PRIMARY KEY (courseCode)
);

CREATE TABLE IF NOT EXISTS Modules(
    moduleCode CHAR(7) NOT NULL,
    fullName VARCHAR(50) NOT NULL,
    deptCode CHAR(3) NOT NULL,
    timeTaught VARCHAR(25) NOT NULL,
    PRIMARY KEY (moduleCode),
    FOREIGN KEY (deptCode) REFERENCES Departments(deptCode)
);

CREATE TABLE IF NOT EXISTS Departments(
    deptCode CHAR(3) NOT NULL,
    fullName VARCHAR(50) NOT NULL,
    PRIMARY KEY (deptCode)
);

CREATE TABLE IF NOT EXISTS BachEquiv(
    courseCode CHAR(6) NOT NULL,
    bachEquiv CHAR(6) NOT NULL,
    PRIMARY KEY (courseCode),
    FOREIGN KEY (courseCode) REFERENCES Course(courseCode) ON DELETE CASCADE,
    FOREIGN KEY (bachEquiv) REFERENCES Course(courseCode)
);

CREATE TABLE IF NOT EXISTS ModulesToCourse(
    moduleCode CHAR(7) NOT NULL,
    courseCode CHAR(6) NOT NULL,
    core BOOLEAN NOT NULL,
    degreeLvl TINYINT NOT NULL,
    CONSTRAINT id PRIMARY KEY (moduleCode, courseCode),
    FOREIGN KEY (moduleCode) REFERENCES Modules(moduleCode) ON DELETE CASCADE,
    FOREIGN KEY (courseCode) REFERENCES Course(courseCode) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS CourseToDepartment(
    courseCode CHAR(6) NOT NULL,
    deptCode CHAR(3) NOT NULL,
    mainDept BOOLEAN NOT NULL,
    CONSTRAINT id PRIMARY KEY (courseCode, deptCode),
    FOREIGN KEY (courseCode) REFERENCES Course(courseCode) ON DELETE CASCADE,
    FOREIGN KEY (deptCode) REFERENCES Departments(deptCode) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS StudentsToModules(
    regNum INT NOT NULL,
    moduleCode CHAR(7) NOT NULL,
    mark DECIAML(5,4),
    resitMark DECIMAL(5,4),
    label CHAR(1) NOT NULL,
    courseCode CHAR(6) NOT NULL,
    degreeLvl TINYINT NOT NULL,
    CONSTRAINT id PRIMARY KEY (regNum, moduleCode),
    FOREIGN KEY (regNum) REFERENCES Students(regNum) ON DELETE CASCADE,
    FOREIGN KEY (moduleCode) REFERENCES Module(moduleCode) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Teacher(
    username VARCHAR(50) NOT NULL,
    fullName VARCHAR(50) NOT NULL,
    PRIMARY KEY (username),
    FOREIGN KEY (username) REFERENCES Accounts(username) ON DELETE CASCADE
);